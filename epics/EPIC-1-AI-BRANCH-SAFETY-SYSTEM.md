# EPIC 1: AI BRANCH SAFETY SYSTEM

**–°—Ç–∞—Ç—É—Å**: üÜï NEW  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• CRITICAL  
**–û—Ü–µ–Ω–∫–∞**: 3 weeks  
**–°–≤—è–∑—å**: AI-Dogfooding Final Plan

## üéØ –û–ü–ò–°–ê–ù–ò–ï

–°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è AI –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ –≤–µ—Ç–∫–∏. AI –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ –≤ ai-–≤–µ—Ç–∫–µ, —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–æ–∫ –≤—Ä—É—á–Ω—É—é, –æ–¥–Ω–∞ –≤–µ—Ç–∫–∞ –Ω–∞ —Å–µ—Å—Å–∏—é/—ç–ø–∏–∫/issue.

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò

- [ ] AI –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ ai-–≤–µ—Ç–∫–∏ –Ω–∞ 100%
- [ ] Whitelist –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞

## üìã ISSUES

### **ISSUE-001: –°–æ–∑–¥–∞—Ç—å AIBranchSafetyManager –∫–ª–∞—Å—Å**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• HIGH
- **–û—Ü–µ–Ω–∫–∞**: 3 –¥–Ω—è
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è AI –æ–ø–µ—Ä–∞—Ü–∏–π
- **Acceptance Criteria**:
  - [ ] –ö–ª–∞—Å—Å `AIBranchSafetyManager` —Å–æ–∑–¥–∞–Ω
  - [ ] –ú–µ—Ç–æ–¥—ã `verify_ai_session_branch()` –∏ `set_session_branch()` —Ä–∞–±–æ—Ç–∞—é—Ç
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ ai-–≤–µ—Ç–æ–∫ (ai/, dogfood/, ai-experiment/)
  - [ ] Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### **ISSUE-002: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É ai-–≤–µ—Ç–æ–∫**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• HIGH  
- **–û—Ü–µ–Ω–∫–∞**: 2 –¥–Ω—è
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ AI –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π ai-–≤–µ—Ç–∫–µ
- **Acceptance Criteria**:
  - [ ] `get_current_git_branch()` –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ ai-–≤–µ—Ç–æ–∫
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤–µ—Ç–∫–∏ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (detached HEAD, etc.)

### **ISSUE-003: –°–æ–∑–¥–∞—Ç—å whitelist –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° MEDIUM
- **–û—Ü–µ–Ω–∫–∞**: 1 –¥–µ–Ω—å  
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –±–µ–∑ ai-–≤–µ—Ç–∫–∏
- **Acceptance Criteria**:
  - [ ] `SAFE_OPERATIONS` —Å–ª–æ–≤–∞—Ä—å —Å–æ–∑–¥–∞–Ω
  - [ ] Read-only –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã (read_file, list_dir, search)
  - [ ] –ê–Ω–∞–ª–∏–∑ –∏ –º–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã
  - [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π whitelist

### **ISSUE-004: –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• HIGH
- **–û—Ü–µ–Ω–∫–∞**: 2 –¥–Ω—è
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ ai-–≤–µ—Ç–∫–∏
- **Acceptance Criteria**:
  - [ ] `DANGEROUS_OPERATIONS` —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω
  - [ ] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ edit_file, delete_file, run_terminal_cmd
  - [ ] –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
  - [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å override –¥–ª—è emergency cases

### **ISSUE-005: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å AI middleware**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° MEDIUM
- **–û—Ü–µ–Ω–∫–∞**: 3 –¥–Ω—è
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è safety manager —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º AI middleware
- **Acceptance Criteria**:
  - [ ] Safety checks –≤ AI middleware pipeline
  - [ ] Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö safety events
  - [ ] Performance –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç >5%

### **ISSUE-006: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è safety manager**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° MEDIUM
- **–û—Ü–µ–Ω–∫–∞**: 2 –¥–Ω—è
- **–û–ø–∏—Å–∞–Ω–∏–µ**: Comprehensive test suite –¥–ª—è safety functionality
- **Acceptance Criteria**:
  - [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
  - [ ] Integration —Ç–µ—Å—Ç—ã —Å git
  - [ ] Mock —Ç–µ—Å—Ç—ã –¥–ª—è edge cases
  - [ ] Coverage >95%

## üèóÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

```python
# core/ai_safety/branch_manager.py
class AIBranchSafetyManager:
    def __init__(self):
        self.session_branch = None
        self.whitelist_operations = SAFE_OPERATIONS
        self.blocked_operations = DANGEROUS_OPERATIONS
    
    def verify_ai_session_branch(self) -> bool
    def set_session_branch(self, branch_name: str)
    def check_operation_permission(self, operation: str) -> Tuple[bool, str]
    def get_current_git_branch(self) -> str
```

## üìä –ú–ï–¢–†–ò–ö–ò

- **Safety Compliance**: 100% –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ ai-–≤–µ—Ç–∫–∏
- **False Positive Rate**: <5% –ª–æ–∂–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ safe –æ–ø–µ—Ä–∞—Ü–∏–π
- **Performance Impact**: <5% overhead –Ω–∞ AI –æ–ø–µ—Ä–∞—Ü–∏–∏
- **Test Coverage**: >95% –¥–ª—è safety –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–¥–∞

## üîó –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

- Git repository –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- Python 3.8+ –¥–ª—è typing support
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π AI middleware framework

## üìù –ó–ê–ú–ï–¢–ö–ò

- –ù–∞—á–∏–Ω–∞–µ–º —Å conservative whitelist, —Ä–∞—Å—à–∏—Ä—è–µ–º –ø–æ –º–µ—Ä–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- Emergency override mechanism –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π
- Comprehensive logging –¥–ª—è audit trail 