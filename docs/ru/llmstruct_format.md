# Спецификация формата JSON для LLMstruct

**Статус документа**: Черновик  
**Версия**: 0.1.0  
**Последнее обновление**: 2025-05-18T00:34:00Z  
**Автор**: Михаил Степанов ([kpblcaoo](https://github.com/kpblcaoo), kpblcaoo@gmail.com)

## 1. Введение

Формат JSON LLMstruct — это универсальная, расширяемая структура для представления кодовых баз, разработанная для автоматизации и интеграции с большими языковыми моделями (LLM). Формат фиксирует модули, функции, классы, графы вызовов и метаданные, поддерживая несколько языков программирования и модульные парсеры.

Этот документ определяет формат, следуя принципам RFC: ясность, открытость и расширяемость. Он предназначен для разработчиков, интеграторов LLM и контрибьюторов проекта LLMstruct.

## 2. Цели

- Создать универсальный JSON-формат для структур кода (модули, функции, классы, вызовы, метаданные).
- Обеспечить расширяемость для новых языков и типов сущностей.
- Поддерживать модульные парсеры на основе плагинов.
- Поддерживать открытый, хорошо документированный формат.
- Обеспечить интеграцию с LLM для автоматизации и контекстно-зависимой помощи.

## 3. Структура JSON

Формат JSON LLMstruct состоит из трех полей верхнего уровня: `metadata`, `toc` и `modules`.

### 3.1. `metadata`

Содержит общую информацию о проекте и статистику.

- **Тип**: Объект
- **Обязательные поля**:
  - `project_name`: Строка, название проекта (например, "llmstruct").
  - `description`: Строка, краткое описание проекта.
  - `version`: Строка, временная метка ISO 8601 генерации (например, "2025-05-18T00:34:00Z").
  - `authors`: Массив объектов, авторы проекта:
    - `name`: Строка, полное имя (например, "Михаил Степанов").
    - `github`: Строка, никнейм GitHub (например, "kpblcaoo").
    - `email`: Строка, контактный email (например, "kpblcaoo@gmail.com").
  - `instructions`: Массив строк, инструкции для использования с LLM.
  - `goals`: Массив строк, цели проекта.
  - `stats`: Объект, статистические данные:
    - `modules_count`: Целое число, количество модулей.
    - `functions_count`: Целое число, количество функций.
    - `classes_count`: Целое число, количество классов.
    - `call_edges_count`: Целое число, количество рёбер графа вызовов.
  - `folder_structure`: Массив объектов, структура директорий/файлов:
    - `path`: Строка, относительный путь (например, "src/llmstruct/cli.py").
    - `type`: Строка, "directory" или "file".
- **Необязательные поля**:
  - На данный момент отсутствуют.

**Пример**:
```json
{
  "metadata": {
    "project_name": "llmstruct",
    "description": "Утилита для генерации структурированного JSON для кодовых баз",
    "version": "2025-05-18T00:34:00Z",
    "authors": [
      {
        "name": "Михаил Степанов",
        "github": "kpblcaoo",
        "email": "kpblcaoo@gmail.com"
      }
    ],
    "instructions": ["Следовать лучшим практикам", "Сохранять функциональность"],
    "goals": ["Создать универсальный JSON-формат", "Обеспечить расширяемость"],
    "stats": {
      "modules_count": 16,
      "functions_count": 35,
      "classes_count": 4,
      "call_edges_count": 959
    },
    "folder_structure": [
      {"path": "src/", "type": "directory"},
      {"path": "src/llmstruct/cli.py", "type": "file"}
    ]
  }
}
```

## 4. Расширяемость

- **Поддержка языков**: Добавляйте парсеры в `src/llmstruct/parsers/` (например, `go_parser.py`) и регистрируйте в `src/llmstruct/parsers/__init__.py`.
- **Новые поля**: Расширяйте `metadata`, `functions` или `classes` необязательными полями (например, `functions[].complexity`).
- **Пользовательские категории**: Обновляйте `infer_category` в парсерах для поддержки новых категорий (например, "tests").

## 5. Использование

Генерация `struct.json`:
```bash
python -m llmstruct ./ -o struct.json --language python
```

## 6. Планы на будущее

- Определить JSON-схему (`schemas/llmstruct_schema.json`).
- Добавить поддержку некодовых файлов (например, метаданные `README.md`).
- Внедрить версионирование (например, `v1.1` для новых полей).
- Создать руководство для контрибьюторов (`CONTRIBUTING.md`).

## 7. История изменений

- **0.1.0 (2025-05-18)**: Первоначальный черновик, основанный на выводе `struct.json`.

## 8. Ссылки

- [Структура проекта LLMstruct](project_structure.md)
- [Модуль Python `ast`](https://docs.python.org/3/library/ast.html)
- [Парсер JavaScript Esprima](https://esprima.org/)