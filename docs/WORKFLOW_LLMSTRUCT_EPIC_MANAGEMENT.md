# LLMStruct Epic Management & Workflow

## Цели
- Минимизировать деградацию контекста при работе LLM и человека с большими задачами.
- Обеспечить прозрачное восстановление фокуса и истории работы.
- Интегрировать эпики, задачи, идеи, инсайты и PR в единую экосистему.

---

## 1. Структура данных
- **Epic roadmap** (`data/sessions/epic_*.json`): структура задач, статусы, ключевые метки, связи с tasks/ideas/insights/prs.
- **Meta-log** (`data/sessions/epic_*_meta.json`): история событий, контрольные метки для LLM, комментарии, эффективность восстановления контекста.
- **Tasks, Ideas, Insights, PRs** (`data/tasks.json`, `data/ideas.json`, `data/insights.json`, `data/prs.json`): отдельные сущности с уникальными id, поддерживают связи друг с другом и с эпиками.

**Все project data JSON-файлы (tasks, ideas, insights, prs и др.) должны храниться в папке `data/`.**

---

## 2. Workflow LLM + человек
### Для LLM:
- На каждом шаге фиксирует событие в meta-log (старт, пауза, переключение задачи, восстановление контекста, завершение).
- Использует контрольные метки (`llm_context`) для удержания фокуса и восстановления состояния.
- При необходимости подгружает связанные задачи/идеи/инсайты/PR по id из roadmap.
- При потере фокуса — восстанавливает состояние по meta-log и отмечает это в истории.

### Для человека:
- Может просматривать и редактировать roadmap и meta-log (например, через CLI или редактор).
- Может добавлять комментарии, корректировать статусы, инициировать паузы/архивацию.
- Может инициировать связывание новых задач/идей/PR с эпиком.

---

## 3. Восстановление и архивация
- Для архивации эпика или паузы фиксируется событие в meta-log (`epic_paused`, `archived_at`, причина).
- Для восстановления — LLM/человек читает последние события meta-log, восстанавливает фокус по `llm_context` и продолжает работу.
- Старые документы и отчёты автоматически перемещаются в `docs/.TO_REVIEW` для ревью и очистки.

---

## 4. Интеграция с tasks/ideas/insights/prs
- В roadmap эпика указываются id связанных задач, идей, инсайтов, PR.
- LLM может автоматически подгружать summary и статусы этих сущностей для анализа и отчётов.
- Можно строить граф связей для глубокого анализа и ретроспектив.

---

## 5. Принципы минимизации деградации контекста
- Разделение roadmap и meta-log: основной план всегда компактный, история — отдельно.
- Контрольные метки (`llm_context`, `attention_marker`) обновляются на каждом шаге.
- В meta-log фиксируются все ключевые события, включая восстановление и потерю фокуса.
- При необходимости LLM/человек может быстро восстановить ход работы даже после долгой паузы.

---

## 6. Пример сценария
1. LLM начинает работу по эпик-роадмапу, фиксирует старт в meta-log.
2. При переключении задачи — обновляет `llm_context` и пишет событие в meta-log.
3. Если работа прерывается — фиксируется пауза, сохраняется состояние.
4. При возврате — LLM/человек читает meta-log, восстанавливает фокус и продолжает.
5. По завершении — фиксируется событие завершения, эпик архивируется.

---

## 7. Рекомендации
- Использовать связи между сущностями для максимальной прозрачности и автоматизации.
- Регулярно архивировать устаревшие документы для поддержания порядка.
- Анализировать эффективность восстановления контекста и корректировать workflow по результатам.

---

## 8. Пример промта для запуска процедуры

```markdown
# Старт работы по эпик-роадмапу

1. Проверь актуальность roadmap и meta-log:
   - Открой файл `data/sessions/epic_<название>.json` (roadmap)
   - Открой файл `data/sessions/epic_<название>_meta.json` (meta-log)
2. Проверь, не был ли эпик в паузе/архиве:
   - Если да, восстанови фокус по последнему `llm_context` из meta-log
3. Запусти процедуру:
   - "Начинаю работу по эпик-роадмапу <epic_id>. Фокус: <current_task>. Все шаги и решения будут фиксироваться в meta-log."
   - При необходимости подгрузи связанные задачи, идеи, инсайты, PR по id из roadmap
4. На каждом шаге:
   - Фиксируй событие в meta-log (старт, переключение, пауза, завершение)
   - Обновляй `llm_context` и attention_marker
   - При потере фокуса — восстанови по meta-log и отметь это
5. По завершении:
   - Зафиксируй событие завершения, обнови статусы, при необходимости заархивируй эпик
```

---

## 9. Пример использования CLI-команды

```bash
python -m llmstruct.cli epic show-links epic_llmstruct_code_quality --type all --format markdown
```

**Пример вывода:**

```markdown
### Связанные tasks:
- **TSK-006**: Improve parser for multi-language support (Python, JS) — in_progress, priority: high

### Связанные ideas:
- **IDEA-005**: Cross-Language Parser Enhancement — in_progress, priority: high

### Связанные insights:
- **INS-001**: Implement validation for broken references in references.json — high

### Связанные prs:
- **PR-001**: Context Orchestration System Implementation — draft, priority: critical
```

---

## Сессионный контроль и тотальное логирование
- Для всех рабочих ситуаций (эпики, планирование, обсуждение, debug, тесты и др.) используйте отдельные event_log, tech_log, meta-log для каждой сессии.
- Все взаимодействия (user, AI, системные) должны логироваться.
- При смене типа работы — создавайте новые логи соответствующего типа.
- AI обязан подмечать и фиксировать возможности улучшения workflow.

**Документ подготовлен автоматически на основе текущей архитектуры и лучших практик LLM workflow.** 